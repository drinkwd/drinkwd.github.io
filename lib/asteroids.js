function Asteroids(){window.ASTEROIDS||(window.ASTEROIDS={enemiesKilled:0});class n{constructor(t,e){"Object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}cp(){return new n(this.x,this.y)}mul(t){return this.x*=t,this.y*=t,this}mulNew(t){return new n(this.x*t,this.y*t)}add(t){return this.x+=t.x,this.y+=t.y,this}addNew(t){return new n(this.x+t.x,this.y+t.y)}sub(t){return this.x-=t.x,this.y-=t.y,this}subNew(t){return new n(this.x-t.x,this.y-t.y)}rotate(t){var e=this.x,s=this.y;return this.x=e*Math.cos(t)-Math.sin(t)*s,this.y=e*Math.sin(t)+Math.cos(t)*s,this}rotateNew(t){return this.cp().rotate(t)}setAngle(t){var e=this.len();return this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this}setAngleNew(t){return this.cp().setAngle(t)}setLength(t){var e=this.len();return e?this.mul(t/e):this.x=this.y=t,this}setLengthNew(t){return this.cp().setLength(t)}normalize(){var t=this.len();return this.x/=t,this.y/=t,this}normalizeNew(){return this.cp().normalize()}angle(){return Math.atan2(this.y,this.x)}collidesWith(t){return this.x>t.x&&this.y>t.y&&this.x<t.x+t.width&&this.y<t.y+t.height}len(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return t<.005&&-.005<t?0:t}is(t){return"object"==typeof t&&this.x===t.x&&this.y===t.y}toString(){return"[Vector("+this.x+", "+this.y+") angle: "+this.angle()+", length: "+this.len()+"]"}}const l=this;var e=!!window.ActiveXObject;let h=document.documentElement.clientWidth,r=document.documentElement.clientHeight;const t=[[-15,-10],[-15,10],[15,0]],a=["HTML","HEAD","BODY","SCRIPT","TITLE","META","STYLE","LINK","SHAPE","LINE","GROUP","IMAGE","STROKE","FILL","SKEW","PATH","TEXTPATH"],s=["BR","HR"],o=e?20:40,d=e?10:20;this.flame={r:[],y:[]},this.toggleBlinkStyle=function(){this.updated.blink.isActive?document.body.classList.remove("ASTEROIDSBLINK"):document.body.classList.add("ASTEROIDSBLINK"),this.updated.blink.isActive=!this.updated.blink.isActive};{e=".ASTEROIDSBLINK .ASTEROIDSYEAHENEMY";var i="outline: 2px dotted red;";const b=document.createElement("style");b.rel="stylesheet",b.id="ASTEROIDSYEAHSTYLES";try{b.innerHTML=e+"{"+i+"}"}catch(t){b.styleSheet.addRule(e,i)}document.getElementsByTagName("head")[0].appendChild(b)}function c(){for(var t of l.enemies)t.classList.remove("ASTEROIDSYEAHENEMY");var s=document.body.getElementsByTagName("*");l.enemies=[];for(let t=0,e;e=s[t];t++)!a.includes(e.tagName.toUpperCase())&&"g_vml_"!==e.prefix&&w(e)&&"ASTEROIDSYEAH"!==e.className&&0<e.offsetHeight&&(e.aSize=function(t){let e=t,s=0,i=0;for(;s+=e.offsetLeft||0,i+=e.offsetTop||0,e=e.offsetParent,e;);return{x:s,y:i,width:t.offsetWidth||10,height:t.offsetHeight||10}}(e),l.enemies.push(e),e.classList.add("ASTEROIDSYEAHENEMY"),e.aAdded||(e.aAdded=!0,l.totalEnemies++))}this.pos=new n(100,100),this.lastPos=!1,this.vel=new n(0,0),this.dir=new n(0,1),this.keysPressed={},this.firedAt=!1,this.updated={enemies:!1,flame:(new Date).getTime(),blink:{time:0,isActive:!1}},this.scrollPos=new n(0,0),this.bullets=[],this.enemies=[],this.dying=[],this.totalEnemies=0,this.particles=[],c();let u;function p(t){return t*Math.PI/180}function m(t,e){return Math.floor(Math.random()*(e+1)+t)}function y(t){for(var e of window.ASTEROIDSPLAYERS)e.gameContainer.style.visibility=t}function f(e){var s=(new Date).getTime(),i=o;for(let t=0;t<i;t++)l.particles.push({dir:new n(20*Math.random()-10,20*Math.random()-10).normalize(),pos:e.cp(),cameAlive:s})}function g(){l.points.innerHTML=10*window.ASTEROIDS.enemiesKilled}function w(e){if(!(e.offsetLeft<-100&&0<e.offsetWidth&&0<e.offsetHeight)){if(s.includes(e.tagName))return 1;if(0!==e.offsetWidth||0!==e.offsetHeight){for(let t=0;t<e.childNodes.length;t++)if(!s.includes(e.childNodes[t].tagName)&&0!==e.childNodes[t].childNodes.length)return;return 1}}}(u=function(){l.flame.r=[[-15,-10]],l.flame.y=[[-15,-6]];for(let t=0;t<20;t+=2)l.flame.r.push([-m(2,7)-15,t-10]);l.flame.r.push([-15,10]);for(let t=0;t<12;t+=12*.2)l.flame.y.push([-m(2,7)-15,t-6]);l.flame.y.push([-15,6])})(),this.gameContainer=document.createElement("div"),this.gameContainer.className="ASTEROIDSYEAH",document.body.appendChild(this.gameContainer),this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",h),this.canvas.setAttribute("height",r),this.canvas.className="ASTEROIDSYEAH",Object.assign(this.canvas.style,{width:h+"px",height:r+"px",position:"fixed",top:"0px",left:"0px",bottom:"0px",right:"0px",zIndex:"10000"}),this.canvas.addEventListener("mousedown",function(t){const e=document.createElement("span");e.style.position="absolute",e.style.color="red",e.innerHTML="Press Esc to Quit",document.body.appendChild(e);var s=t.pageX||t.clientX+document.documentElement.scrollLeft,t=t.pageY||t.clientY+document.documentElement.scrollTop;e.style.left=s-e.offsetWidth/2+"px",e.style.top=t-e.offsetHeight/2+"px",setTimeout(function(){try{e.parentNode.removeChild(e)}catch(t){}},1e3)},!1);const A=function(){l.canvas.style.display="none",h=document.documentElement.clientWidth,r=document.documentElement.clientHeight,l.canvas.setAttribute("width",h),l.canvas.setAttribute("height",r),Object.assign(l.canvas.style,{display:"block",width:h+"px",height:r+"px"})},E=(window.addEventListener("resize",A,!1),this.gameContainer.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="black",this.ctx.strokeStyle="black",document.getElementById("ASTEROIDS-NAVIGATION")?(this.navigation=document.getElementById("ASTEROIDS-NAVIGATION"),this.points=document.getElementById("ASTEROIDS-POINTS")):(this.navigation=document.createElement("div"),this.navigation.id="ASTEROIDS-NAVIGATION",this.navigation.className="ASTEROIDSYEAH",Object.assign(this.navigation.style,{fontFamily:"Arial,sans-serif",position:"fixed",zIndex:"10001",bottom:"20px",right:"10px",textAlign:"right"}),this.navigation.innerHTML="(Press Esc to Quit) ",this.gameContainer.appendChild(this.navigation),this.points=document.createElement("span"),this.points.id="ASTEROIDS-POINTS",this.points.style.font="28pt Arial, sans-serif",this.points.style.fontWeight="bold",this.points.className="ASTEROIDSYEAH",this.navigation.appendChild(this.points)),g(),function(t){if(l.keysPressed[t.key]=!0," "===t.key&&(l.firedAt=1),["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"," ","b","w","a","s","d"].includes(t.key))return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,!(t.cancelBubble=!0)}),v=(document.addEventListener("keydown",E,!1),function(t){if(["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"," ","w","a","s","d"].includes(t.key))return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,!(t.cancelBubble=!0)}),S=(document.addEventListener("keypress",v,!1),function(t){if(l.keysPressed[t.key]=!1,["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"," ","b","w","a","s","d"].includes(t.key))return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,!(t.cancelBubble=!0)});document.addEventListener("keyup",S,!1),this.ctx.clear=function(){this.clearRect(0,0,h,r)},this.ctx.clear(),this.ctx.drawLine=function(t,e,s,i){this.beginPath(),this.moveTo(t,e),this.lineTo(s,i),this.lineTo(s+1,i+1),this.closePath(),this.fill()},this.ctx.tracePoly=function(e){this.beginPath(),this.moveTo(e[0][0],e[0][1]);for(let t=1;t<e.length;t++)this.lineTo(e[t][0],e[t][1]);this.closePath()},this.ctx.drawPlayer=function(){this.save(),this.translate(l.pos.x,l.pos.y),this.rotate(l.dir.angle()),this.tracePoly(t),this.fillStyle="white",this.fill(),this.tracePoly(t),this.stroke(),this.restore()},this.ctx.drawBullets=function(e){for(let t=0;t<e.length;t++)this.beginPath(),this.arc(e[t].pos.x,e[t].pos.y,2,0,2*Math.PI,!0),this.closePath(),this.fill()};this.ctx.drawParticles=function(e){var t=this.fillStyle;for(let t=0;t<e.length;t++)this.fillStyle=["red","yellow"][m(0,1)],this.drawLine(e[t].pos.x,e[t].pos.y,e[t].pos.x-10*e[t].dir.x,e[t].pos.y-10*e[t].dir.y);this.fillStyle=t},this.ctx.drawFlames=function(t){this.save(),this.translate(l.pos.x,l.pos.y),this.rotate(l.dir.angle());var e=this.strokeStyle;this.strokeStyle="red",this.tracePoly(t.r),this.stroke(),this.strokeStyle="yellow",this.tracePoly(t.y),this.stroke(),this.strokeStyle=e,this.restore()},f(this.pos),document.body.classList.add("ASTEROIDSYEAH");let x=(new Date).getTime();function T(){l.update.call(l)}setTimeout(T,20),this.update=function(){let e=!1;var s=(new Date).getTime(),i=(s-x)/1e3;let t=!1;if(50<(x=s)-this.updated.flame&&(u(),this.updated.flame=s),this.scrollPos.x=window.pageXOffset||document.documentElement.scrollLeft,this.scrollPos.y=window.pageYOffset||document.documentElement.scrollTop,this.keysPressed.ArrowUp||this.keysPressed.w?(this.vel.add(this.dir.mulNew(300*i)),t=!0):this.vel.mul(.96),(this.keysPressed.ArrowLeft||this.keysPressed.a)&&(e=!0,this.dir.rotate(p(360*i*-1))),(this.keysPressed.ArrowRight||this.keysPressed.d)&&(e=!0,this.dir.rotate(p(360*i))),this.keysPressed[" "]&&150<s-this.firedAt&&(this.bullets.unshift({dir:this.dir.cp(),pos:this.pos.cp(),startVel:this.vel.cp(),cameAlive:s}),this.firedAt=s,this.bullets.length>d&&this.bullets.pop()),this.keysPressed.b?(this.updated.enemies||(c(),this.updated.enemies=!0),e=!0,this.updated.blink.time+=1e3*i,250<this.updated.blink.time&&(this.toggleBlinkStyle(),this.updated.blink.time=0)):this.updated.enemies=!1,this.keysPressed.Escape)!function(){document.removeEventListener("keydown",E,!1),document.removeEventListener("keypress",v,!1),document.removeEventListener("keyup",S,!1),window.removeEventListener("resize",A,!1),function(t){const e=document.getElementById(t);e&&e.parentNode.removeChild(e)}("ASTEROIDSYEAHSTYLES"),document.body.classList.remove("ASTEROIDSYEAH"),this.gameContainer.parentNode.removeChild(this.gameContainer)}.apply(this);else{600<this.vel.len()&&this.vel.setLength(600),this.pos.add(this.vel.mulNew(i)),this.pos.x>h?(window.scrollTo(this.scrollPos.x+50,this.scrollPos.y),this.pos.x=0):this.pos.x<0&&(window.scrollTo(this.scrollPos.x-50,this.scrollPos.y),this.pos.x=h),this.pos.y>r?(window.scrollTo(this.scrollPos.x,this.scrollPos.y+.75*r),this.pos.y=0):this.pos.y<0&&(window.scrollTo(this.scrollPos.x,this.scrollPos.y-.75*r),this.pos.y=r);for(let t=this.bullets.length-1;0<=t;t--)if(2e3<s-this.bullets[t].cameAlive)this.bullets.splice(t,1),e=!0;else{var n=this.bullets[t].dir.setLengthNew(700*i).add(this.bullets[t].startVel.mulNew(i));this.bullets[t].pos.add(n),(n=this.bullets[t].pos).x>h?n.x=0:n.x<0&&(n.x=h),n.y>r?n.y=0:n.y<0&&(n.y=r);const o=function(t,e){y("hidden");let s=document.elementFromPoint(t,e);return s?(3===s.nodeType&&(s=s.parentNode),y("visible"),s):(y("visible"),!1)}(this.bullets[t].pos.x,this.bullets[t].pos.y);o&&o.tagName&&!a.includes(o.tagName.toUpperCase())&&w(o)&&"ASTEROIDSYEAH"!==o.className&&(f(this.bullets[t].pos),this.dying.push(o),this.bullets.splice(t,1))}if(this.dying.length){for(let t=this.dying.length-1;0<=t;t--)try{this.dying[t].parentNode&&window.ASTEROIDS.enemiesKilled++,this.dying[t].parentNode.removeChild(this.dying[t])}catch(t){}g(),this.dying=[]}for(let t=this.particles.length-1;0<=t;t--)this.particles[t].pos.add(this.particles[t].dir.mulNew(400*i*Math.random())),1e3<s-this.particles[t].cameAlive&&(this.particles.splice(t,1),e=!0);(e||0!==this.bullets.length||0!==this.particles.length||!this.pos.is(this.lastPos)||0<this.vel.len())&&(this.ctx.clear(),this.ctx.drawPlayer(),t&&this.ctx.drawFlames(l.flame),this.bullets.length&&this.ctx.drawBullets(this.bullets),this.particles.length&&this.ctx.drawParticles(this.particles)),this.lastPos=this.pos,setTimeout(T,20)}}}window.ASTEROIDSPLAYERS||(window.ASTEROIDSPLAYERS=[]),window.ASTEROIDSPLAYERS.push(new Asteroids);